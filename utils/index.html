
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Formation PostGIS">
      
      
        <meta name="author" content="3Liz">
      
      
        <link rel="canonical" href="https://docs.3liz.org/formation-postgis/utils/">
      
      <link rel="icon" href="../logo.svg">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>Fonctions utiles - Formation PostGIS</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cc9b2e1e.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
    
    
    
      
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="deep-orange">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fonctions-utiles" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Formation PostGIS" class="md-header__button md-logo" aria-label="Formation PostGIS" data-md-component="logo">
      
  <img src="../logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Formation PostGIS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Fonctions utiles
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/3liz/formation-postgis/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Formation PostGIS" class="md-nav__button md-logo" aria-label="Formation PostGIS" data-md-component="logo">
      
  <img src="../logo.svg" alt="logo">

    </a>
    Formation PostGIS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/3liz/formation-postgis/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        docs.3liz.org
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Accueil
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../links_and_data/" class="md-nav__link">
        Liens et données
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../postgresql_in_qgis/" class="md-nav__link">
        Gestion des données
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../import_data/" class="md-nav__link">
        Import des données
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../sql_select/" class="md-nav__link">
        Sélection
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../perform_calculation/" class="md-nav__link">
        Calcul & Fonctions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../filter_data/" class="md-nav__link">
        Filtrer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../group_data/" class="md-nav__link">
        Regrouper
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../union/" class="md-nav__link">
        Rassembler
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../save_queries/" class="md-nav__link">
        Enregistrer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../join_data/" class="md-nav__link">
        Jointures
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../merge_geometries/" class="md-nav__link">
        Fusionner
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../triggers/" class="md-nav__link">
        Triggers
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../validate_geometries/" class="md-nav__link">
        Correction géométries
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../check_topology/" class="md-nav__link">
        Topologie
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Fonctions utiles
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Fonctions utiles
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ajout-de-lauto-incrementation-sur-un-champ-entier" class="md-nav__link">
    Ajout de l'auto-incrémentation sur un champ entier
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creation-automatique-dindexes-spatiaux" class="md-nav__link">
    Création automatique d'indexes spatiaux
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trouver-toutes-les-tables-sans-cle-primaire" class="md-nav__link">
    Trouver toutes les tables sans clé primaire
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ajouter-automatiquement-plusieurs-champs-a-plusieurs-tables" class="md-nav__link">
    Ajouter automatiquement plusieurs champs à plusieurs tables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verifier-la-taille-des-bases-tables-et-schemas" class="md-nav__link">
    Vérifier la taille des bases, tables et schémas
  </a>
  
    <nav class="md-nav" aria-label="Vérifier la taille des bases, tables et schémas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connaitre-la-taille-des-bases-de-donnees" class="md-nav__link">
    Connaître la taille des bases de données
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calculer-la-taille-des-tables" class="md-nav__link">
    Calculer la taille des tables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calculer-la-taille-des-schemas" class="md-nav__link">
    Calculer la taille des schémas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tester-les-differences-entre-2-tables-de-meme-structure" class="md-nav__link">
    Tester les différences entre 2 tables de même structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lister-les-triggers-appliques-sur-les-tables" class="md-nav__link">
    Lister les triggers appliqués sur les tables
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../grant/" class="md-nav__link">
        Droits
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../fdw/" class="md-nav__link">
        Données externes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tutoriel/" class="md-nav__link">
        Tutoriels en ligne
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ajout-de-lauto-incrementation-sur-un-champ-entier" class="md-nav__link">
    Ajout de l'auto-incrémentation sur un champ entier
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creation-automatique-dindexes-spatiaux" class="md-nav__link">
    Création automatique d'indexes spatiaux
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trouver-toutes-les-tables-sans-cle-primaire" class="md-nav__link">
    Trouver toutes les tables sans clé primaire
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ajouter-automatiquement-plusieurs-champs-a-plusieurs-tables" class="md-nav__link">
    Ajouter automatiquement plusieurs champs à plusieurs tables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verifier-la-taille-des-bases-tables-et-schemas" class="md-nav__link">
    Vérifier la taille des bases, tables et schémas
  </a>
  
    <nav class="md-nav" aria-label="Vérifier la taille des bases, tables et schémas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connaitre-la-taille-des-bases-de-donnees" class="md-nav__link">
    Connaître la taille des bases de données
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calculer-la-taille-des-tables" class="md-nav__link">
    Calculer la taille des tables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calculer-la-taille-des-schemas" class="md-nav__link">
    Calculer la taille des schémas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tester-les-differences-entre-2-tables-de-meme-structure" class="md-nav__link">
    Tester les différences entre 2 tables de même structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lister-les-triggers-appliques-sur-les-tables" class="md-nav__link">
    Lister les triggers appliqués sur les tables
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/3liz/formation-postgis/edit/master/docs/utils.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="fonctions-utiles">Fonctions utiles<a class="headerlink" href="#fonctions-utiles" title="Permanent link">#</a></h1>
<p>Nous regroupons ici quelques fonctions réalisées au cours de formations ou d'accompagnements d'utilisateurs de PostgreSQL.</p>
<h2 id="ajout-de-lauto-incrementation-sur-un-champ-entier">Ajout de l'auto-incrémentation sur un champ entier<a class="headerlink" href="#ajout-de-lauto-incrementation-sur-un-champ-entier" title="Permanent link">#</a></h2>
<p>Lorsqu'on importe une couche dans une table via les outils de QGIS, le champ d'identifiant choisi n'a pas le support de l'auto-incrémentation, ce qui peut poser des problèmes de l'ajout de nouvelles données.</p>
<p>Par exemple, pour une séquence <code>monschema.ma_sequence</code>, si la requête suivante échoue, c'est que la séquence n'est en effet pas correctement configurée :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">currval</span><span class="p">(</span><span class="s1">&#39;&quot;monschema&quot;.&quot;test_id_seq&quot;&#39;</span><span class="p">);</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Pour ajouter le support de l'auto-incrémentation sur un champ entier à une table existante, on peut utiliser les commandes suivantes:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">-- Création de la séquence</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">SEQUENCE</span><span class="w"> </span><span class="n">monschema</span><span class="p">.</span><span class="n">test_id_seq</span><span class="p">;</span><span class="w"></span>

<span class="c1">-- Modification du champ pour ajouter la valeur par défaut</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">monschema</span><span class="p">.</span><span class="n">test</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;&quot;monschema&quot;.&quot;test_id_seq&quot;&#39;</span><span class="p">);</span><span class="w"></span>

<span class="c1">-- Modification de la valeur actuelle de la séquence au maximum du champ id</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">setval</span><span class="p">(</span><span class="s1">&#39;&quot;monschema&quot;.&quot;test_id_seq&quot;&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">monschema</span><span class="p">.</span><span class="n">test</span><span class="p">));</span><span class="w"></span>

<span class="c1">-- Déclarer à PostgreSQL que la séquence et le champ sont liés</span>
<span class="k">ALTER</span><span class="w"> </span><span class="n">SEQUENCE</span><span class="w"> </span><span class="n">monschema</span><span class="p">.</span><span class="n">test_id_seq</span><span class="w"> </span><span class="n">OWNED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">monschema</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">id</span><span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Dans l'exemple ci-dessus, le schéma est précisé.</p>
<h2 id="creation-automatique-dindexes-spatiaux">Création automatique d'indexes spatiaux<a class="headerlink" href="#creation-automatique-dindexes-spatiaux" title="Permanent link">#</a></h2>
<p>Pour des données spatiales volumineuses, les performances d'affichage sont bien meilleures à grande échelle si on a ajouté un <strong>index spatial</strong>. L'index est aussi beaucoup utilisé pour améliorer les performances d'analyses spatiales.</p>
<p>On peut créer l'index spatial table par table, ou bien automatiser cette création, c'est-à-dire créer les indexes spatiaux <strong>pour toutes les tables qui n'en ont pas</strong>.</p>
<p>Pour cela, nous avons conçu une fonction, téléchargeable ici: <a href="https://gist.github.com/mdouchin/cfa0e37058bcf102ed490bc59d762042">https://gist.github.com/mdouchin/cfa0e37058bcf102ed490bc59d762042</a></p>
<p>On doit copier/coller le script SQL de cette page "gist" dans la <strong>fenêtre SQL</strong> du Gestionnaire de bases de données de QGIS, puis lancer la requête avec <strong>Exécuter</strong>. On peut ensuite vider le contenu de la fenêtre, puis appeler la fonction <code>create_missing_spatial_indexes</code> via le code SQL suivant:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">-- On lance avec le paramètre à True si on veut juste voir les tables qui n&#39;ont pas d&#39;index spatial</span>
<span class="c1">-- On lance avec False si on veut créer les indexes automatiquement</span>

<span class="c1">-- Vérification</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">create_missing_spatial_indexes</span><span class="p">(</span><span class="w">  </span><span class="k">True</span><span class="w"> </span><span class="p">);</span><span class="w"></span>

<span class="c1">-- Création</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">create_missing_spatial_indexes</span><span class="p">(</span><span class="w">  </span><span class="k">False</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<h2 id="trouver-toutes-les-tables-sans-cle-primaire">Trouver toutes les tables sans clé primaire<a class="headerlink" href="#trouver-toutes-les-tables-sans-cle-primaire" title="Permanent link">#</a></h2>
<p>Il est très important de déclarer une clé primaire pour vos tables stockées dans PostgreSQL. Cela fournit un moyen aux logiciels comme QGIS d'identifier de manière performante les lignes dans une table. Sans clé primaire, les performances d'accès aux données peuvent être dégradées.</p>
<p>Vous pouvez trouver l'ensemble des tables de votre base de données sans clé primaire en construisant cette vue PostgreSQL <code>tables_without_primary_key</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">tables_without_primary_key</span><span class="p">;</span><span class="w"></span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">tables_without_primary_key</span><span class="w"> </span><span class="k">AS</span><span class="w"></span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">table_schema</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="k">table_name</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w"></span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">table_constraints</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w"></span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">table_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">table_schema</span><span class="w"></span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="k">table_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="k">table_name</span><span class="w"></span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">constraint_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;PRIMARY KEY&#39;</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">True</span><span class="w"></span>
<span class="k">AND</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">table_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;BASE TABLE&#39;</span><span class="w"></span>
<span class="k">AND</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">table_schema</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;pg_catalog&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;information_schema&#39;</span><span class="p">)</span><span class="w"></span>
<span class="k">AND</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="k">constraint_name</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"></span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">table_schema</span><span class="p">,</span><span class="w"> </span><span class="k">table_name</span><span class="w"></span>
<span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Pour lister les tables sans géométries, vous pouvez ensuite lancer la requête suivante:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">tables_without_primary_key</span><span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Ce qui peut donner par exemple:</p>
<table>
<thead>
<tr>
<th>table_schema</th>
<th>table_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>agriculture</td>
<td>parcelles</td>
</tr>
<tr>
<td>agriculture</td>
<td>puits</td>
</tr>
<tr>
<td>cadastre</td>
<td>sections</td>
</tr>
<tr>
<td>environnement</td>
<td>znieff</td>
</tr>
<tr>
<td>environnement</td>
<td>parcs_naturels</td>
</tr>
</tbody>
</table>
<ul>
<li>Pour lister les tables sans géométries d'un seul schéma, par exemple <code>cadastre</code>, vous pouvez ensuite lancer la requête:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">tables_without_primary_key</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">table_schema</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;cadastre&#39;</span><span class="p">);</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Ce qui peut alors donner:</p>
<table>
<thead>
<tr>
<th>table_schema</th>
<th>table_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>cadastre</td>
<td>sections</td>
</tr>
</tbody>
</table>
<h2 id="ajouter-automatiquement-plusieurs-champs-a-plusieurs-tables">Ajouter automatiquement plusieurs champs à plusieurs tables<a class="headerlink" href="#ajouter-automatiquement-plusieurs-champs-a-plusieurs-tables" title="Permanent link">#</a></h2>
<p>Il est parfois nécessaire d'<strong>ajouter des champs à une ou plusieurs tables</strong>, par exemple pour y stocker ensuite des métadonnées (date de modification, date d'ajout, utilisateur, lien, etc).</p>
<p>Nous proposons pour cela la fonction <code>ajout_champs_dynamiques</code> qui permet de fournir un nom de schéma, un nom de table, et une chaîne de caractère contenant la liste séparée par virgule des champs et de leur type.</p>
<p>La fonction est accessible ici: <a href="https://gist.github.com/mdouchin/50234f1f33801aed6f4f2cbab9f4887c">https://gist.github.com/mdouchin/50234f1f33801aed6f4f2cbab9f4887c</a></p>
<ul>
<li>Exemple d'utilisation <strong>pour une table</strong> <code>commune</code> du schéma <code>test</code>: on ajoute les champs <code>date_creation</code>, <code>date_modification</code> et <code>utilisateur</code></li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="n">ajout_champs_dynamiques</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;commune&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;date_creation timestamp DEFAULT now(), date_modification timestamp DEFAULT now(), utilisateur text&#39;</span><span class="p">)</span><span class="w"></span>
<span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Exemple d'utilisation pour <strong>toutes les tables d'un schéma</strong>, ici le schéma <code>test</code>. On utilise dans cette exemple la vue <code>geometry_columns</code> qui liste les tables spatiales, car on souhaite aussi ne faire cet ajout que pour les données de type <strong>POINT</strong></li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">-- Lancer la création de champs sur toutes les tables</span>
<span class="c1">-- du schéma test</span>
<span class="c1">-- contenant des géométries de type Point</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">f_table_schema</span><span class="p">,</span><span class="w"> </span><span class="n">f_table_name</span><span class="p">,</span><span class="w"></span>
<span class="n">ajout_champs_dynamiques</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="c1">-- schéma</span>
<span class="w">    </span><span class="n">f_table_schema</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c1">-- table</span>
<span class="w">    </span><span class="n">f_table_name</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c1">-- liste des champs, au format nom_du_champ TYPE</span>
<span class="w">    </span><span class="s1">&#39;date_creation timestamp DEFAULT now(), date_modification timestamp DEFAULT now(), utilisateur text&#39;</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">geometry_columns</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">True</span><span class="w"></span>
<span class="k">AND</span><span class="w"> </span><span class="ss">&quot;type&quot;</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%POINT&#39;</span><span class="w"></span>
<span class="k">AND</span><span class="w"> </span><span class="n">f_table_schema</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span><span class="w"></span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">f_table_schema</span><span class="p">,</span><span class="w"> </span><span class="n">f_table_name</span><span class="w"></span>
<span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<h2 id="verifier-la-taille-des-bases-tables-et-schemas">Vérifier la taille des bases, tables et schémas<a class="headerlink" href="#verifier-la-taille-des-bases-tables-et-schemas" title="Permanent link">#</a></h2>
<h3 id="connaitre-la-taille-des-bases-de-donnees">Connaître la taille des bases de données<a class="headerlink" href="#connaitre-la-taille-des-bases-de-donnees" title="Permanent link">#</a></h3>
<p>On peut lancer la requête suivante, qui renvoit les bases de données ordonnées par taille descendante.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="n">pg_database</span><span class="p">.</span><span class="n">datname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">db_name</span><span class="p">,</span><span class="w"></span>
<span class="n">pg_database_size</span><span class="p">(</span><span class="n">pg_database</span><span class="p">.</span><span class="n">datname</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">db_size</span><span class="p">,</span><span class="w"></span>
<span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">pg_database_size</span><span class="p">(</span><span class="n">pg_database</span><span class="p">.</span><span class="n">datname</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">db_pretty_size</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pg_database</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">datname</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;template0&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;template1&#39;</span><span class="p">)</span><span class="w"></span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">db_size</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<h3 id="calculer-la-taille-des-tables">Calculer la taille des tables<a class="headerlink" href="#calculer-la-taille-des-tables" title="Permanent link">#</a></h3>
<p>On crée une fonction <code>get_table_info</code> qui utilise les tables système pour lister les tables, récupérer leur schéma et les informations de taille.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">get_table_info</span><span class="p">();</span><span class="w"></span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">get_table_info</span><span class="p">()</span><span class="w"></span>
<span class="k">RETURNS</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">oid</span><span class="w"> </span><span class="n">oid</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">schema_name</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">table_name</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">row_count</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">total_size</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">pretty_total_size</span><span class="w"> </span><span class="nb">text</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
<span class="k">AS</span><span class="w"> </span><span class="err">$$</span><span class="w"></span>
<span class="k">BEGIN</span><span class="w"></span>
<span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="n">QUERY</span><span class="w"></span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"></span>
<span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="n">oid</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="k">schema_name</span><span class="p">::</span><span class="nb">text</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="k">table_name</span><span class="p">::</span><span class="nb">text</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="k">row_count</span><span class="p">::</span><span class="nb">integer</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="n">total_size</span><span class="p">::</span><span class="nb">bigint</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">total_size</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">pretty_total_size</span><span class="w"></span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">a</span><span class="p">.</span><span class="n">total_size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">index_bytes</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">toast_bytes</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">table_bytes</span><span class="w"></span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"></span>
<span class="w">            </span><span class="k">c</span><span class="p">.</span><span class="n">oid</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">nspname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">schema_name</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">relname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">TABLE_NAME</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="k">c</span><span class="p">.</span><span class="n">reltuples</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">row_count</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">pg_total_relation_size</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">oid</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_size</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">pg_indexes_size</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">oid</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">index_bytes</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">pg_total_relation_size</span><span class="p">(</span><span class="n">reltoastrelid</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">toast_bytes</span><span class="w"></span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">pg_class</span><span class="w"> </span><span class="k">c</span><span class="w"></span>
<span class="w">            </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">pg_namespace</span><span class="w"> </span><span class="n">n</span><span class="w"></span>
<span class="w">                </span><span class="k">ON</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">oid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">relnamespace</span><span class="w"></span>
<span class="w">            </span><span class="k">WHERE</span><span class="w"> </span><span class="n">relkind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;r&#39;</span><span class="w"></span>
<span class="w">            </span><span class="k">AND</span><span class="w"> </span><span class="n">nspname</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;pg_catalog&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;information_schema&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
<span class="w">    </span><span class="p">;</span><span class="w"></span>
<span class="k">END</span><span class="p">;</span><span class="w"> </span><span class="err">$$</span><span class="w"></span>
<span class="k">LANGUAGE</span><span class="w"> </span><span class="s1">&#39;plpgsql&#39;</span><span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>On peut l'utiliser simplement de la manière suivante</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">-- Liste les tables</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">get_table_info</span><span class="p">()</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">schema_name</span><span class="p">,</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w"></span>

<span class="c1">-- Lister les tables dans l&#39;ordre inverse de taille</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">get_table_info</span><span class="p">()</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">total_size</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<h3 id="calculer-la-taille-des-schemas">Calculer la taille des schémas<a class="headerlink" href="#calculer-la-taille-des-schemas" title="Permanent link">#</a></h3>
<p>On crée une simple fonction qui renvoit la somme des tailles des tables d'un schéma</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">-- Fonction pour calculer la taille d&#39;un schéma</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">pg_schema_size</span><span class="p">(</span><span class="k">schema_name</span><span class="w"> </span><span class="nb">text</span><span class="p">)</span><span class="w"></span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w"> </span><span class="k">AS</span><span class="w"></span>
<span class="err">$$</span><span class="w"></span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"></span>
<span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">pg_total_relation_size</span><span class="p">(</span><span class="n">quote_ident</span><span class="p">(</span><span class="n">schemaname</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">quote_ident</span><span class="p">(</span><span class="n">tablename</span><span class="p">)))::</span><span class="nb">BIGINT</span><span class="w"></span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">pg_tables</span><span class="w"></span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">schemaname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">schema_name</span><span class="w"></span>
<span class="err">$$</span><span class="w"></span>
<span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>On peut alors l'utiliser pour connaître la taille d'un schéma</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">-- utilisation pour un schéma</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">pg_schema_size</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Ou lister l'ensemble des schémas</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">-- lister les schémas et récupérer leur taille</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">schema_name</span><span class="p">,</span><span class="w"> </span><span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">pg_schema_size</span><span class="p">(</span><span class="k">schema_name</span><span class="p">))</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">schemata</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">schema_name</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;pg_catalog&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;information_schema&#39;</span><span class="p">)</span><span class="w"></span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">pg_schema_size</span><span class="p">(</span><span class="k">schema_name</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<h2 id="tester-les-differences-entre-2-tables-de-meme-structure">Tester les différences entre 2 tables de même structure<a class="headerlink" href="#tester-les-differences-entre-2-tables-de-meme-structure" title="Permanent link">#</a></h2>
<p>Nous souhaitons <strong>comparer deux tables de la base</strong>, par exemple une table de communes en 2021 <code>communes_2021</code> et une table de communes en 2022 <code>communes_2022</code>.</p>
<p>On peut utiliser une fonction qui utilise les possibilités du format hstore pour comparer les données entre elles.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">-- On ajoute le support du format hstore</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">EXTENSION</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">hstore</span><span class="p">;</span><span class="w"></span>

<span class="c1">-- On crée la fonction de comparaison</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">compare_tables</span><span class="p">(</span><span class="nb">text</span><span class="p">,</span><span class="nb">text</span><span class="p">,</span><span class="nb">text</span><span class="p">,</span><span class="nb">text</span><span class="p">,</span><span class="nb">text</span><span class="p">,</span><span class="nb">text</span><span class="p">[]);</span><span class="w"></span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">compare_tables</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">p_schema_name_a</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">p_table_name_a</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">p_schema_name_b</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">p_table_name_b</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">p_common_identifier_field</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">p_excluded_fields</span><span class="w"> </span><span class="nb">text</span><span class="p">[]</span><span class="w"></span>

<span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="k">TABLE</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">uid</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">table_a_values</span><span class="w"> </span><span class="n">hstore</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">table_b_values</span><span class="w"> </span><span class="n">hstore</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">LANGUAGE</span><span class="w"> </span><span class="n">plpgsql</span><span class="w"></span>
<span class="w">    </span><span class="k">AS</span><span class="w"> </span><span class="err">$</span><span class="n">_$</span><span class="w"></span>
<span class="k">DECLARE</span><span class="w"></span>
<span class="w">    </span><span class="n">sqltemplate</span><span class="w"> </span><span class="nb">text</span><span class="p">;</span><span class="w"></span>
<span class="k">BEGIN</span><span class="w"></span>

<span class="w">    </span><span class="c1">-- Compare data</span>
<span class="w">    </span><span class="n">sqltemplate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;</span>
<span class="s1">    SELECT</span>
<span class="s1">        coalesce(ta.&quot;%1$s&quot;, tb.&quot;%1$s&quot;) AS &quot;%1$s&quot;,</span>
<span class="s1">        CASE</span>
<span class="s1">            WHEN ta.&quot;%1$s&quot; IS NULL THEN &#39;&#39;not in table A&#39;&#39;</span>
<span class="s1">            WHEN tb.&quot;%1$s&quot; IS NULL THEN &#39;&#39;not in table B&#39;&#39;</span>
<span class="s1">            ELSE &#39;&#39;table A != table B&#39;&#39;</span>
<span class="s1">        END AS status,</span>
<span class="s1">        CASE</span>
<span class="s1">            WHEN ta.&quot;%1$s&quot; IS NULL THEN NULL</span>
<span class="s1">            ELSE (hstore(ta.*) - &#39;&#39;%6$s&#39;&#39;::text[]) - (hstore(tb) - &#39;&#39;%6$s&#39;&#39;::text[])</span>
<span class="s1">        END AS values_in_table_a,</span>
<span class="s1">        CASE</span>
<span class="s1">            WHEN tb.&quot;%1$s&quot; IS NULL THEN NULL</span>
<span class="s1">            ELSE (hstore(tb.*) - &#39;&#39;%6$s&#39;&#39;::text[]) - (hstore(ta) - &#39;&#39;%6$s&#39;&#39;::text[])</span>
<span class="s1">        END AS values_in_table_b</span>
<span class="s1">    FROM &quot;%2$s&quot;.&quot;%3$s&quot; AS ta</span>
<span class="s1">    FULL JOIN &quot;%4$s&quot;.&quot;%5$s&quot; AS tb</span>
<span class="s1">        ON ta.&quot;%1$s&quot; = tb.&quot;%1$s&quot;</span>
<span class="s1">    WHERE</span>
<span class="s1">        (hstore(ta.*) - &#39;&#39;%6$s&#39;&#39;::text[]) != (hstore(tb.*) - &#39;&#39;%6$s&#39;&#39;::text[])</span>
<span class="s1">        OR (ta.&quot;%1$s&quot; IS NULL)</span>
<span class="s1">        OR (tb.&quot;%1$s&quot; IS NULL)</span>
<span class="s1">    &#39;</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="n">QUERY</span><span class="w"></span>
<span class="w">    </span><span class="k">EXECUTE</span><span class="w"> </span><span class="n">format</span><span class="p">(</span><span class="n">sqltemplate</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">p_common_identifier_field</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">p_schema_name_a</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">p_table_name_a</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">p_schema_name_b</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">p_table_name_b</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">p_excluded_fields</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>

<span class="k">END</span><span class="p">;</span><span class="w"></span>
<span class="err">$</span><span class="n">_$</span><span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Cette fonction attend en paramètres</p>
<ul>
<li>le schéma de la <strong>table A</strong>. Ex: <code>referentiels</code></li>
<li>le nom de la <strong>table A</strong>. Ex: <code>communes_2021</code></li>
<li>le schéma de la <strong>table B</strong>. Ex: <code>referentiels</code></li>
<li>le nom de la <strong>table B</strong>. Ex: <code>communes_2022</code></li>
<li>le nom du champ qui identifie de manière unique la donnée. Ce n'est pas forcément la clé primaire. Ex <code>code_commune</code></li>
<li>un tableau de champs pour lesquels ne pas vérifier les différences. Ex: <code>array['region', 'departement']</code></li>
</ul>
<p>La requête à lancer est la suivantes
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="ss">&quot;uid&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;status&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;table_a_values&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;table_b_values&quot;</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">compare_tables</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="s1">&#39;referentiels&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;commune_2021&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s1">&#39;referentiels&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;commune_2022&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s1">&#39;code_commune&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nb">array</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;departement&#39;</span><span class="p">]</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">uid</span><span class="w"></span>
<span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div></p>
<p>Exemple de données renvoyées:</p>
<table>
<thead>
<tr>
<th>uid</th>
<th>status</th>
<th>table_a_values</th>
<th>table_b_values</th>
</tr>
</thead>
<tbody>
<tr>
<td>12345</td>
<td>not in table A</td>
<td>NULL</td>
<td>"annee_ref"=&gt;"2022", "nom_commune"=&gt;"Nouvelle commune", "population"=&gt;"5723"</td>
</tr>
<tr>
<td>97612</td>
<td>not in table B</td>
<td>"annee_ref"=&gt;"2021", "nom_commune"=&gt;"Ancienne commune", "population"=&gt;"840"</td>
<td>NULL</td>
</tr>
<tr>
<td>97602</td>
<td>table A != table B</td>
<td>"annee_ref"=&gt;"2021", "population"=&gt;"1245"</td>
<td>"annee_ref"=&gt;"2022", "population"=&gt;"1322"</td>
</tr>
</tbody>
</table>
<p>Dans l'affichage ci-dessus, je n'ai pas affiché le champ de géométrie, mais la fonction teste aussi les différences de géométries.</p>
<p><em>Attention, les performances de ce type de requête ne sont pas forcément assurées pour des volumes de données importants.</em></p>
<h2 id="lister-les-triggers-appliques-sur-les-tables">Lister les triggers appliqués sur les tables<a class="headerlink" href="#lister-les-triggers-appliques-sur-les-tables" title="Permanent link">#</a></h2>
<p>On peut utiliser la requête suivante pour lister l'ensemble des triggers activés sur les tables</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">SELECT</span><span class="w"></span>
<span class="w">    </span><span class="n">event_object_schema</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">table_schema</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">event_object_table</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">table_name</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">trigger_schema</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">trigger_name</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">string_agg</span><span class="p">(</span><span class="n">event_manipulation</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">action_timing</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">activation</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">action_condition</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">action_statement</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">definition</span><span class="w"></span>
<span class="k">FROM</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">triggers</span><span class="w"></span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="w"></span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">table_schema</span><span class="p">,</span><span class="w"> </span><span class="k">table_name</span><span class="w"></span>
<span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Continuer vers <a href="../grant/">Gestion des droits</a></p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">May 16, 2022</span>
      
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../check_topology/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Topologie" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Topologie
            </div>
          </div>
        </a>
      
      
        
        <a href="../grant/" class="md-footer__link md-footer__link--next" aria-label="Next: Droits" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Droits
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <span class="copyleft">&copy;</span> 3Liz
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://twitter.com/3LIZ_news" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.linkedin.com/company/3liz" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/3liz/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://hub.docker.com/u/3liz" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs.sticky", "navigation.top"], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a6c66575.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.6.4/dist/mermaid.min.js"></script>
      
    
  </body>
</html>